angular.module("angularValidator",[]),angular.module("angularValidator").service("angularValidator",["$compile","alertGuy",function(a,b){function c(){var a=[];if(angular.forEach(o.form,function(a){a&&a.$name&&o.form[a.$name]&&(o.form[a.$name].$setValidity(a.$name,!0),o.form[a.$name].$render())}),o.validation&&Object.keys(o.validation).length>0&&angular.forEach(Object.keys(o.validation),function(b){var c=o.validation[b];console.log(o.form[b]),o.form[b]?(o.form[b].$setValidity(b,!1),console.log(c),c.description&&angular.element(o.DOMForm[b]).attr("invalid-message","'"+c.description+"'")):a.push(c)}),a.length){var c="";for(i=0;i<a.length;i++)c+=a[i].description+".\n\n";b.alert({title:"There were errors in the data you sent",text:c})}}function d(a){o.validation=a}function e(a){o.form=a}function f(b,c){var d=function(){return"'<i class=\"fa fa-times\"></i> Required'"},e=function(){return"'<i class=\"fa fa-times\"></i> Invalid'"};if(b.name in o.scopeForm){var f=o.scopeForm[b.name],i=h(b);i&&i.remove(),(f.$dirty||o.scopeForm.submitted)&&(f.$error.required?"required-message"in b.attributes?angular.element(b).after(a(g(b.attributes["required-message"].value,f,o.scope))(o.scope)):angular.element(b).after(a(g(d(),f,o.scope))(o.scope)):f.$valid||("invalid-message"in b.attributes?angular.element(b).after(a(g(b.attributes["invalid-message"].value,f,o.scope))(o.scope)):c?angular.element(b).after(a(g(c.message(f,b,o.scope),f))(o.scope)):angular.element(b).after(a(g(e(),f,o.scope))(o.scope))))}}function g(a,b,c){var d=c?c.$eval(a):a;return'<validation class="control-label has-error validationMessage"><a class="btn btn-tiny btn-validation-error" ng-click="showValid.'+b.$name+" = !showValid."+b.$name+'"></a><div class="sub-tooltip mod-validation-error ng-hide" ng-show="showValid.'+b.$name+'" ng-click="showValid.'+b.$name+" = !showValid."+b.$name+'"><p>'+d+"</p></div></validation>"}function h(a){for(var b=angular.element(a).parent().children(),c=0;c<b.length;c++)if(angular.element(b[c]).hasClass("validationMessage"))return angular.element(b[c]);return!1}var j,k,l,m={},n={},o={scope:j,scopeForm:k,DOMForm:l,form:m,setForm:e,validation:n,setValidation:d,parseValidation:c,updateValidationMessage:f};return o}]),angular.module("angularValidator").directive("angularValidator",["$injector","$parse","$compile","angularValidator",function(a,b,c,d){return{restrict:"A",link:function(e,f,g,h){function i(b){return!!(b&&"invalid-message"in b.attributes)&&a.get(b.attributes["invalid-message"].value)}function j(a){for(var b=i(a),c=0;c<a.length;c++)c in a&&k(a[c],b)}function k(a,b){"validate-on"in a.attributes&&"blur"===a.attributes["validate-on"].value&&angular.element(a).on("blur",function(){d.updateValidationMessage(a,b),o(a)});var c=e.$watch(function(){return a.value+a.required+d.scopeForm.submitted+n(a)+l(d.scopeForm[a.name])+m(d.scopeForm[a.name])},function(){if(d.scopeForm.submitted)d.updateValidationMessage(a,b),o(a);else{var c="validate-on"in a.attributes&&"dirty"===a.attributes["validate-on"].value;c?(d.updateValidationMessage(a,b),o(a)):d.scopeForm[a.name]&&d.scopeForm[a.name].$pristine&&(d.updateValidationMessage(a,b),o(a))}});r.push(c)}function l(a){if(a&&"$dirty"in a)return a.$dirty}function m(a){if(a&&"$valid"in a)return a.$valid}function n(a){if("validator"in a.attributes){var b=e.$eval(a.attributes.validator.value);return d.scopeForm[a.name].$setValidity("angularValidator",b),b}}function o(a){if(a.name in d.scopeForm){var b=d.scopeForm[a.name];angular.element(a).removeClass("has-error"),angular.element(a.parentNode).removeClass("has-error"),(b.$dirty||d.scopeForm.submitted)&&b.$invalid&&(angular.element(a.parentNode).addClass("has-error"),angular.element(a).addClass("has-error"))}}var p=function(){return Math.floor(1e5*Math.random())};d.scope=e;var q=!1;if(angular.forEach(f.find("input,select,textarea"),function(a){a=$(a),a.attr("name")||(a.attr("name",p()),console.log("WARNING! AngularValidator -> One of your form elements(<input>, <textarea>, <select>) is missing a name. We got your back and added a name, but if you want a pretty one you should add it yourself."),q=!0)}),g.name||(f.attr("name","TGAV_FORM_"+p()),console.log("WARNING! AngularValidator -> Your form element(<form>) is missing a name. We got your back and added a name, but if you want a pretty one you should add it yourself."),q=!0),q)return void c(f)(e);d.DOMForm=angular.element(f)[0];var r=[];d.scopeForm=b(g.name)(e),d.scopeForm.submitted=!1,e.$watch(function(){return Object.keys(d.scopeForm).length},function(){angular.forEach(r,function(a){a()}),j(d.DOMForm)}),f.on("submit",function(a){a.preventDefault(),e.$apply(function(){d.scopeForm.submitted=!0}),d.setForm(d.scopeForm),d.parseValidation(),(d.scopeForm.$valid||d.scopeForm.clientValid)&&(d.scopeForm.clientValid=!0,e.$apply(function(){e.$eval(g.angularValidatorSubmit)}))}),d.scopeForm.reset=function(){angular.forEach(d.DOMForm,function(a){a.name&&d.scopeForm[a.name]&&(d.scopeForm[a.name].$setViewValue(""),d.scopeForm[a.name].$render())}),d.scopeForm.submitted=!1,d.scopeForm.$setPristine()},j(d.DOMForm)}}}]);