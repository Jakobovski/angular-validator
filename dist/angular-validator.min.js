angular.module("angularValidator",[]),angular.module("angularValidator").service("angularValidator",["$compile","alertGuy",function(a,b){function j(){var a=[];if(angular.forEach(h.form,function(a){a&&a.$name&&h.form[a.$name]&&(h.form[a.$name].$setValidity(a.$name,!0),h.form[a.$name].$render())}),h.validation&&Object.keys(h.validation).length>0&&angular.forEach(Object.keys(h.validation),function(b){var c=h.validation[b];h.form[b]?(h.form[b].$setValidity(b,!1),c.description&&angular.element(h.DOMForm[h.form][b]).attr("invalid-message","'"+c.description+"'")):a.push(c)}),a.length){var c="";for(i=0;i<a.length;i++)c+=a[i].description+".\n\n";b.alert({title:"There were errors in the data you sent",text:c})}}function k(a){h.validation=a}function l(a){h.form=a}function m(b,c,d){var e=function(){return"'<i class=\"fa fa-times\"></i> Required'"},f=function(){return"'<i class=\"fa fa-times\"></i> Invalid'"};if(b.name in h.scopeForm[d]){var g=h.scopeForm[d][b.name],i=o(b);i&&i.remove(),(g.$dirty||h.scopeForm[d].submitted)&&(g.$error.required?"required-message"in b.attributes?angular.element(b).after(a(n(b.attributes["required-message"].value,g,h.scope))(h.scope)):angular.element(b).after(a(n(e(),g,h.scope))(h.scope)):g.$valid||("invalid-message"in b.attributes?angular.element(b).after(a(n(b.attributes["invalid-message"].value,g,h.scope))(h.scope)):c?angular.element(b).after(a(n(c.message(g,b,h.scope),g))(h.scope)):angular.element(b).after(a(n(f(),g,h.scope))(h.scope))))}}function n(a,b,c){var d=c?c.$eval(a):a;return'<validation class="control-label has-error validationMessage"><a class="btn btn-tiny btn-validation-error" ng-click="showValid.'+b.$name+" = !showValid."+b.$name+'"></a><div class="sub-tooltip mod-validation-error ng-hide" ng-show="showValid.'+b.$name+'" ng-click="showValid.'+b.$name+" = !showValid."+b.$name+'"><p>'+d+"</p></div></validation>"}function o(a){for(var b=angular.element(a).parent().children(),c=0;c<b.length;c++)if(angular.element(b[c]).hasClass("validationMessage"))return angular.element(b[c]);return!1}var c,d={},e={},f={},g={},h={scope:c,scopeForm:d,DOMForm:g,form:e,setForm:l,validation:f,setValidation:k,parseValidation:j,updateValidationMessage:m};return h}]),angular.module("angularValidator").directive("angularValidator",["$injector","$parse","$compile","angularValidator",function(a,b,c,d){return{restrict:"A",link:function(e,f,g,h){function l(b){return!!(b&&"invalid-message"in b.attributes)&&a.get(b.attributes["invalid-message"].value)}function m(a){for(var b=l(a),c=0;c<a.length;c++)c in a&&n(a[c],b)}function n(a,b){"validate-on"in a.attributes&&"blur"===a.attributes["validate-on"].value&&angular.element(a).on("blur",function(){d.updateValidationMessage(a,b,g.name),r(a)});var c=e.$watch(function(){return a.value+a.required+d.scopeForm[g.name].submitted+q(a)+o(d.scopeForm[g.name][a.name])+p(d.scopeForm[g.name][a.name])},function(){if(d.scopeForm[g.name].submitted)d.updateValidationMessage(a,b,g.name),r(a);else{var c="validate-on"in a.attributes&&"dirty"===a.attributes["validate-on"].value;c?(d.updateValidationMessage(a,b,g.name),r(a)):d.scopeForm[g.name][a.name]&&d.scopeForm[g.name][a.name].$pristine&&(d.updateValidationMessage(a,b,g.name),r(a))}});k.push(c)}function o(a){if(a&&"$dirty"in a)return a.$dirty}function p(a){if(a&&"$valid"in a)return a.$valid}function q(a){if("validator"in a.attributes){var b=e.$eval(a.attributes.validator.value);return d.scopeForm[g.name][a.name]&&d.scopeForm[g.name][a.name].$setValidity("angularValidator",b),b}}function r(a){if(a.name in d.scopeForm[g.name]){var b=d.scopeForm[g.name][a.name];angular.element(a).removeClass("has-error"),angular.element(a.parentNode).removeClass("has-error"),(b.$dirty||d.scopeForm[g.name].submitted)&&b.$invalid&&(angular.element(a.parentNode).addClass("has-error"),angular.element(a).addClass("has-error"))}}var i=function(){return Math.floor(1e5*Math.random())};d.scope=e;var j=!1;if(angular.forEach(f.find("input,select,textarea"),function(a){a=$(a),a.attr("name")||(a.attr("name",i()),console.log("WARNING! AngularValidator -> One of your form elements(<input>, <textarea>, <select>) is missing a name. We got your back and added a name, but if you want a pretty one you should add it yourself."),j=!0)}),g.name||(f.attr("name","TGAV_FORM_"+i()),console.log("WARNING! AngularValidator -> Your form element(<form>) is missing a name. We got your back and added a name, but if you want a pretty one you should add it yourself."),j=!0),j)return void c(f)(e);d.DOMForm[g.name]=angular.element(f)[0];var k=[];d.scopeForm[g.name]=b(g.name)(e),d.scopeForm[g.name].submitted=!1,e.$watch(function(){return Object.keys(d.scopeForm[g.name]).length},function(){angular.forEach(k,function(a){a()}),m(d.DOMForm[g.name])}),f.on("submit",function(a){a.preventDefault(),e.$apply(function(){d.scopeForm[g.name].submitted=!0}),d.setForm(d.scopeForm[g.name]),d.parseValidation(),(d.scopeForm[g.name].$valid||d.scopeForm[g.name].clientValid)&&(d.scopeForm[g.name].clientValid=!0,e.$apply(function(){e.$eval(g.angularValidatorSubmit)}))}),d.scopeForm[g.name].reset=function(){angular.forEach(d.DOMForm[g.name],function(a){a.name&&d.scopeForm[g.name][a.name]&&(d.scopeForm[g.name][a.name].$setViewValue(""),d.scopeForm[g.name][a.name].$render())}),d.scopeForm[g.name].submitted=!1,d.scopeForm[g.name].$setPristine()},m(d.DOMForm[g.name])}}}]);
